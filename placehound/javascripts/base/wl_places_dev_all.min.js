if(!window.WELOCALLY){window.WELOCALLY={env:{init:function(){},initJQuery:function(){if(typeof(jQuery.fn.parseJSON)=="undefined"||typeof(jQuery.parseJSON)!="function"){jQuery.extend({parseJSON:function(a){if(typeof a!=="string"||!a){return null}a=jQuery.trim(a);if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return window.JSON&&window.JSON.parse?window.JSON.parse(a):(new Function("return "+a))()}else{jQuery.error("Invalid JSON: "+a)}}})}}},ui:{setStatus:function(d,e,c,b){var a=this;jQuery(d).html("");jQuery(d).removeClass();jQuery(d).addClass(c);if(b){jQuery(d).append(b)}jQuery(d).append("<em>"+e+"</em>");if(e!=""){jQuery(d).show()}else{jQuery(d).hide()}}},util:{getErrorString:function(b){var a="";jQuery.each(b,function(c,d){a=a+(c+1)+". "+d.errorMessage+" "});return a},log:function(a){if(window.console){console.log(a)}},serialize:function(e,c){var f=[];for(var d in e){var b=c?c+"["+d+"]":d,a=e[d];f.push(typeof a=="object"?serialize(a,b):encodeURIComponent(b)+"="+encodeURIComponent(a))}return f.join("&")},trim:function(a){return WELOCALLY.util.ltrim(WELOCALLY.util.rtrim(a)," ")},ltrim:function(a){return a.replace(new RegExp("^[ ]+","g"),"")},rtrim:function(a){return a.replace(new RegExp("[ ]+$","g"),"")},preload:function(a){jQuery(a).each(function(){jQuery("<img/>")[0].src=this})},update:function(){var d=arguments[0],c=1,b=arguments.length,a;for(;c<b;c++){for(a in arguments[c]){d[a]=arguments[c][a]}}return d},escape:function(a){return((a==null)?"":a).toString().replace(/[<>"&\\]/g,function(b){switch(b){case"<":return"&lt;";case">":return"&gt;";case'"':return'"';case"&":return"&amp;";case"\\":return"\\\\";default:return b}})},unescape:function(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'")},notundef:function(d,c){return typeof(d)=="undefined"?c:d},guidGenerator:function(){return(WELOCALLY.util.S4()+WELOCALLY.util.S4()+"-"+WELOCALLY.util.S4()+"-"+WELOCALLY.util.S4()+"-"+WELOCALLY.util.S4()+"-"+WELOCALLY.util.S4()+WELOCALLY.util.S4()+WELOCALLY.util.S4())},keyGenerator:function(){return(WELOCALLY.util.S4()+WELOCALLY.util.S4())},tokenGenerator:function(){return(WELOCALLY.util.S4()+WELOCALLY.util.S4()+WELOCALLY.util.S4()+WELOCALLY.util.S4()+WELOCALLY.util.S4()+WELOCALLY.util.S4()+WELOCALLY.util.S4()+WELOCALLY.util.S4())},S4:function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)},replaceAll:function(a,b,c){return a.replace(new RegExp(b,"g"),c)},startsWith:function(b,a){return b.indexOf(a)==0},getParameter:function(b,a){var a=a+"=";if(b.length>0){begin=b.indexOf(a);if(begin!=-1){begin+=a.length;end=b.indexOf("&",begin);if(end==-1){end=b.length}return unescape(b.substring(begin,end))}return"null"}}}}}function WELOCALLY_GoogleDocsLoad(a){this.cfg;this.jqxhr;this.observers;this.init=function(){var b=[];if(!a){b.push("Please provide configuration for the widget");a={}}if(!a.key){b.push("A key is required to open a spreadsheet.")}if(!a.row){b.push("Please specify the row for the place.")}this.cfg=a;return this}}WELOCALLY_GoogleDocsLoad.prototype.load=function(){var _instance=this;var surl="https://spreadsheets.google.com/feeds/cells/"+_instance.cfg.key+"/default/public/basic?alt=json-in-script&callback=?";jQuery.each(_instance.cfg.observers,function(i,observer){WELOCALLY.ui.setStatus(observer.getStatusArea(),"Finding places","wl_update",true)});jQuery.ajax({url:surl,dataType:"jsonp",success:function(data){if(data!=null&&data.errors!=null){jQuery.each(_instance.cfg.observers,function(i,observer){WELOCALLY.ui.setStatus(observer.getStatusArea(),"ERROR:"+WELOCALLY.util.getErrorString(data.errors),"wl_error",false)})}else{if(data!=null&&data.feed.entry.length>0){var places=[];var row=0;var currentPlace=null;jQuery.each(data.feed.entry,function(i,entry){var rownum=eval(entry.title.$t.substring(1,entry.title.$t.length));if(rownum==_instance.cfg.row){if((/A/).test(entry.title.$t)){if(currentPlace!=null){places.push(currentPlace)}currentPlace={};currentPlace.properties={};currentPlace.properties.classifiers=[];currentPlace.properties.classifiers[0]={};currentPlace.geometry={};currentPlace.geometry.type="Point";currentPlace.geometry.coordinates=[];currentPlace.properties.name=entry.content.$t}else{if((/B/).test(entry.title.$t)){currentPlace.properties.address=entry.content.$t}else{if((/C/).test(entry.title.$t)){currentPlace.properties.city=entry.content.$t}else{if((/D/).test(entry.title.$t)){currentPlace.properties.province=entry.content.$t}else{if((/E/).test(entry.title.$t)){currentPlace.properties.postcode=entry.content.$t}else{if((/F/).test(entry.title.$t)){currentPlace.properties.country=entry.content.$t}else{if((/G/).test(entry.title.$t)){currentPlace.properties.website=entry.content.$t}else{if((/H/).test(entry.title.$t)){currentPlace.properties.phone=entry.content.$t}else{if((/I/).test(entry.title.$t)){currentPlace.properties.classifiers[0].type=entry.content.$t}else{if((/J/).test(entry.title.$t)){currentPlace.properties.classifiers[0].category=entry.content.$t}else{if((/K/).test(entry.title.$t)){currentPlace.properties.classifiers[0].subcategory=entry.content.$t}else{if((/L/).test(entry.title.$t)){currentPlace.geometry.coordinates[1]=entry.content.$t}else{if((/M/).test(entry.title.$t)){currentPlace.geometry.coordinates[0]=entry.content.$t}}}}}}}}}}}}}}});jQuery.each(_instance.cfg.observers,function(i,observer){WELOCALLY.ui.setStatus(observer.getStatusArea(),"","wl_message",false);if(currentPlace!=null){observer.load(currentPlace)}})}else{jQuery.each(_instance.cfg.observers,function(i,observer){WELOCALLY.ui.setStatus(observer.getStatusArea(),"No results were found matching your search.","wl_warning",false)})}}}});return false};function WELOCALLY_GoogleDocsSearch(a){this.cfg;this.jqxhr;this.observers;this.init=function(){var b=[];if(!a){b.push("Please provide configuration for the widget");a={}}if(!a.key){b.push("A key is required to open a spreadsheet.")}if(!a.zoom){a.zoom=16}if(!a.location){a.location=new google.maps.LatLng(38.548165,-96.064453)}if(!a.showShare){a.showShare=false}this.cfg=a;return this}}WELOCALLY_GoogleDocsSearch.prototype.search=function(){var _instance=this;var surl="https://spreadsheets.google.com/feeds/cells/"+_instance.cfg.key+"/default/public/basic?alt=json-in-script&callback=?";jQuery.each(_instance.cfg.observers,function(i,observer){observer.setStatus(observer.getStatusArea(),"Finding places","wl_update",true)});jQuery.ajax({url:surl,dataType:"jsonp",success:function(data){if(data!=null&&data.errors!=null){jQuery.each(_instance.cfg.observers,function(i,observer){observer.setStatus(observer.getStatusArea(),"ERROR:"+WELOCALLY.util.getErrorString(data.errors),"wl_error",false)})}else{if(data!=null&&data.feed.entry.length>0){var places=[];var row=0;var currentPlace=null;jQuery.each(data.feed.entry,function(i,entry){var rownum=eval(entry.title.$t.substring(1,entry.title.$t.length));if(rownum>1){if((/A/).test(entry.title.$t)){if(currentPlace!=null){places.push(currentPlace)}currentPlace={};currentPlace.properties={};currentPlace.properties.classifiers=[];currentPlace.properties.classifiers[0]={};currentPlace.geometry={};currentPlace.geometry.type="Point";currentPlace.geometry.coordinates=[];currentPlace.properties.name=entry.content.$t}else{if((/B/).test(entry.title.$t)){currentPlace.properties.address=entry.content.$t}else{if((/C/).test(entry.title.$t)){currentPlace.properties.city=entry.content.$t}else{if((/D/).test(entry.title.$t)){currentPlace.properties.province=entry.content.$t}else{if((/E/).test(entry.title.$t)){currentPlace.properties.postcode=entry.content.$t}else{if((/F/).test(entry.title.$t)){currentPlace.properties.country=entry.content.$t}else{if((/G/).test(entry.title.$t)){currentPlace.properties.website=entry.content.$t}else{if((/H/).test(entry.title.$t)){currentPlace.properties.phone=entry.content.$t}else{if((/I/).test(entry.title.$t)){currentPlace.properties.classifiers[0].type=entry.content.$t}else{if((/J/).test(entry.title.$t)){currentPlace.properties.classifiers[0].category=entry.content.$t}else{if((/K/).test(entry.title.$t)){currentPlace.properties.classifiers[0].subcategory=entry.content.$t}else{if((/L/).test(entry.title.$t)){currentPlace.geometry.coordinates[1]=entry.content.$t}else{if((/M/).test(entry.title.$t)){currentPlace.geometry.coordinates[0]=entry.content.$t}}}}}}}}}}}}}}});if(currentPlace!=null){places.push(currentPlace)}jQuery.each(_instance.cfg.observers,function(i,observer){observer.setStatus(observer.getStatusArea(),"","wl_message",false);observer.setPlaces(places)})}else{jQuery.each(_instance.cfg.observers,function(i,observer){observer.setStatus(observer.getStatusArea(),"No results were found matching your search.","wl_warning",false)})}}}});return false};function WELOCALLY_InfoBox(a){a=a||{};google.maps.OverlayView.apply(this,arguments);this.content_=a.content||"";this.disableAutoPan_=a.disableAutoPan||false;this.maxWidth_=a.maxWidth||0;this.pixelOffset_=a.pixelOffset||new google.maps.Size(0,0);this.position_=a.position||new google.maps.LatLng(0,0);this.zIndex_=a.zIndex||null;this.boxClass_=a.boxClass||"infoBox";this.boxStyle_=a.boxStyle||{};this.closeBoxMargin_=a.closeBoxMargin||"2px";this.closeBoxURL_=a.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif";if(a.closeBoxURL===""){this.closeBoxURL_=""}this.infoBoxClearance_=a.infoBoxClearance||new google.maps.Size(1,1);this.isHidden_=a.isHidden||false;this.alignBottom_=a.alignBottom||false;this.pane_=a.pane||"floatPane";this.enableEventPropagation_=a.enableEventPropagation||false;this.div_=null;this.closeListener_=null;this.eventListener1_=null;this.eventListener2_=null;this.eventListener3_=null;this.moveListener_=null;this.contextListener_=null;this.fixedWidthSet_=null}WELOCALLY_InfoBox.prototype=new google.maps.OverlayView();WELOCALLY_InfoBox.prototype.createInfoBoxDiv_=function(){var d;var a=this;var b=function(f){f.cancelBubble=true;if(f.stopPropagation){f.stopPropagation()}};var c=function(f){f.returnValue=false;if(f.preventDefault){f.preventDefault()}if(!a.enableEventPropagation_){b(f)}};if(!this.div_){this.div_=document.createElement("div");this.setBoxStyle_();if(typeof this.content_.nodeType==="undefined"){this.div_.innerHTML=this.getCloseBoxImg_()+this.content_}else{this.div_.innerHTML=this.getCloseBoxImg_();this.div_.appendChild(this.content_)}this.getPanes()[this.pane_].appendChild(this.div_);this.addClickHandler_();if(this.div_.style.width){this.fixedWidthSet_=true}else{if(this.maxWidth_!==0&&this.div_.offsetWidth>this.maxWidth_){this.div_.style.width=this.maxWidth_;this.div_.style.overflow="auto";this.fixedWidthSet_=true}else{d=this.getBoxWidths_();this.div_.style.width=(this.div_.offsetWidth-d.left-d.right)+"px";this.fixedWidthSet_=false}}this.panBox_(this.disableAutoPan_);if(!this.enableEventPropagation_){this.eventListener1_=google.maps.event.addDomListener(this.div_,"mousedown",b);this.eventListener2_=google.maps.event.addDomListener(this.div_,"click",b);this.eventListener3_=google.maps.event.addDomListener(this.div_,"dblclick",b);this.eventListener4_=google.maps.event.addDomListener(this.div_,"mouseover",function(f){this.style.cursor="default"})}this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",c);google.maps.event.trigger(this,"domready")}};WELOCALLY_InfoBox.prototype.getCloseBoxImg_=function(){var a="";if(this.closeBoxURL_!==""){var b=64;a='<span style=" float: right; cursor: pointer; display:block; width: 16px; height: 16px; background:url('+this.closeBoxURL_+") -"+b+'px 0px; background-repeat:no-repeat; margin: 3px;" />'}return a};WELOCALLY_InfoBox.prototype.addClickHandler_=function(){var a;if(this.closeBoxURL_!==""){a=this.div_.firstChild;this.closeListener_=google.maps.event.addDomListener(a,"click",this.getCloseClickHandler_())}else{this.closeListener_=null}};WELOCALLY_InfoBox.prototype.getCloseClickHandler_=function(){var a=this;return function(b){b.cancelBubble=true;if(b.stopPropagation){b.stopPropagation()}a.close();google.maps.event.trigger(a,"closeclick")}};WELOCALLY_InfoBox.prototype.panBox_=function(p){var d;var b;var n=0,j=0;if(!p){d=this.getMap();if(d instanceof google.maps.Map){if(!d.getBounds().contains(this.position_)){d.setCenter(this.position_)}b=d.getBounds();var r=d.getDiv();var k=r.offsetWidth;var m=r.offsetHeight;var f=this.pixelOffset_.width;var e=this.pixelOffset_.height;var l=this.div_.offsetWidth;var q=this.div_.offsetHeight;var h=this.infoBoxClearance_.width;var g=this.infoBoxClearance_.height;var a=this.getProjection().fromLatLngToContainerPixel(this.position_);if(a.x<(-f+h)){n=a.x+f-h}else{if((a.x+l+f+h)>k){n=a.x+l+f+h-k}}if(this.alignBottom_){if(a.y<(-e+g+q)){j=a.y+e-g-q}else{if((a.y+e+g)>m){j=a.y+e+g-m}}}else{if(a.y<(-e+g)){j=a.y+e-g}else{if((a.y+q+e+g)>m){j=a.y+q+e+g-m}}}if(!(n===0&&j===0)){var o=d.getCenter();d.panBy(n,j)}}}};WELOCALLY_InfoBox.prototype.setBoxStyle_=function(){var a,b;if(this.div_){this.div_.className=this.boxClass_;this.div_.style.cssText="";b=this.boxStyle_;for(a in b){if(b.hasOwnProperty(a)){this.div_.style[a]=b[a]}}if(typeof this.div_.style.opacity!=="undefined"&&this.div_.style.opacity!==""){this.div_.style.filter="alpha(opacity="+(this.div_.style.opacity*100)+")"}this.div_.style.position="absolute";this.div_.style.visibility="hidden";if(this.zIndex_!==null){this.div_.style.zIndex=this.zIndex_}}};WELOCALLY_InfoBox.prototype.getBoxWidths_=function(){var a;var c={top:0,bottom:0,left:0,right:0};var b=this.div_;if(document.defaultView&&document.defaultView.getComputedStyle){a=b.ownerDocument.defaultView.getComputedStyle(b,"");if(a){c.top=parseInt(a.borderTopWidth,10)||0;c.bottom=parseInt(a.borderBottomWidth,10)||0;c.left=parseInt(a.borderLeftWidth,10)||0;c.right=parseInt(a.borderRightWidth,10)||0}}else{if(document.documentElement.currentStyle){if(b.currentStyle){c.top=parseInt(b.currentStyle.borderTopWidth,10)||0;c.bottom=parseInt(b.currentStyle.borderBottomWidth,10)||0;c.left=parseInt(b.currentStyle.borderLeftWidth,10)||0;c.right=parseInt(b.currentStyle.borderRightWidth,10)||0}}}return c};WELOCALLY_InfoBox.prototype.onRemove=function(){if(this.div_){this.div_.parentNode.removeChild(this.div_);this.div_=null}};WELOCALLY_InfoBox.prototype.draw=function(){this.createInfoBoxDiv_();var a=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=(a.x+this.pixelOffset_.width)+"px";if(this.alignBottom_){this.div_.style.bottom=-(a.y+this.pixelOffset_.height)+"px"}else{this.div_.style.top=(a.y+this.pixelOffset_.height)+"px"}if(this.isHidden_){this.div_.style.visibility="hidden"}else{this.div_.style.visibility="visible"}};WELOCALLY_InfoBox.prototype.setOptions=function(a){if(typeof a.boxClass!=="undefined"){this.boxClass_=a.boxClass;this.setBoxStyle_()}if(typeof a.boxStyle!=="undefined"){this.boxStyle_=a.boxStyle;this.setBoxStyle_()}if(typeof a.content!=="undefined"){this.setContent(a.content)}if(typeof a.disableAutoPan!=="undefined"){this.disableAutoPan_=a.disableAutoPan}if(typeof a.maxWidth!=="undefined"){this.maxWidth_=a.maxWidth}if(typeof a.pixelOffset!=="undefined"){this.pixelOffset_=a.pixelOffset}if(typeof a.alignBottom!=="undefined"){this.alignBottom_=a.alignBottom}if(typeof a.position!=="undefined"){this.setPosition(a.position)}if(typeof a.zIndex!=="undefined"){this.setZIndex(a.zIndex)}if(typeof a.closeBoxMargin!=="undefined"){this.closeBoxMargin_=a.closeBoxMargin}if(typeof a.closeBoxURL!=="undefined"){this.closeBoxURL_=a.closeBoxURL}if(typeof a.infoBoxClearance!=="undefined"){this.infoBoxClearance_=a.infoBoxClearance}if(typeof a.isHidden!=="undefined"){this.isHidden_=a.isHidden}if(typeof a.enableEventPropagation!=="undefined"){this.enableEventPropagation_=a.enableEventPropagation}if(this.div_){this.draw()}};WELOCALLY_InfoBox.prototype.setContent=function(a){this.content_=a;if(this.div_){if(this.closeListener_){google.maps.event.removeListener(this.closeListener_);this.closeListener_=null}if(!this.fixedWidthSet_){this.div_.style.width=""}if(typeof a.nodeType==="undefined"){this.div_.innerHTML=this.getCloseBoxImg_()+a}else{this.div_.innerHTML=this.getCloseBoxImg_();this.div_.appendChild(a)}if(!this.fixedWidthSet_){this.div_.style.width=this.div_.offsetWidth+"px";if(typeof a.nodeType==="undefined"){this.div_.innerHTML=this.getCloseBoxImg_()+a}else{this.div_.innerHTML=this.getCloseBoxImg_()}}this.addClickHandler_()}google.maps.event.trigger(this,"content_changed")};WELOCALLY_InfoBox.prototype.setPosition=function(a){this.position_=a;if(this.div_){this.draw()}google.maps.event.trigger(this,"position_changed")};WELOCALLY_InfoBox.prototype.setZIndex=function(a){this.zIndex_=a;if(this.div_){this.div_.style.zIndex=a}google.maps.event.trigger(this,"zindex_changed")};WELOCALLY_InfoBox.prototype.getContent=function(){return this.content_};WELOCALLY_InfoBox.prototype.getPosition=function(){return this.position_};WELOCALLY_InfoBox.prototype.getZIndex=function(){return this.zIndex_};WELOCALLY_InfoBox.prototype.show=function(){this.isHidden_=false;if(this.div_){this.div_.style.visibility="visible"}};WELOCALLY_InfoBox.prototype.hide=function(){this.isHidden_=true;if(this.div_){this.div_.style.visibility="hidden"}};WELOCALLY_InfoBox.prototype.setOffset=function(contentsBox){var infobox=this;var base_cfg={baseOffsetX:0,baseOffsetY:0};var width=eval(jQuery(contentsBox).css("width").replace("px",""));if(width==0){width=eval(jQuery(contentsBox).css("min-width").replace("px",""))}var offsetX=((width/2)+10)*-1;infobox.pixelOffset_=new google.maps.Size(offsetX+base_cfg.baseOffsetX,base_cfg.baseOffsetY)};WELOCALLY_InfoBox.prototype.open=function(c,a){var b=this;if(a){this.position_=a.getPosition();this.moveListener_=google.maps.event.addListener(a,"position_changed",function(){b.setPosition(this.getPosition())})}this.setMap(c)};WELOCALLY_InfoBox.prototype.close=function(){if(this.closeListener_){google.maps.event.removeListener(this.closeListener_);this.closeListener_=null}if(this.eventListener1_){google.maps.event.removeListener(this.eventListener1_);google.maps.event.removeListener(this.eventListener2_);google.maps.event.removeListener(this.eventListener3_);google.maps.event.removeListener(this.eventListener4_);this.eventListener1_=null;this.eventListener2_=null;this.eventListener3_=null;this.eventListener4_=null}if(this.moveListener_){google.maps.event.removeListener(this.moveListener_);this.moveListener_=null}if(this.contextListener_){google.maps.event.removeListener(this.contextListener_);this.contextListener_=null}this.setMap(null)};function WELOCALLY_PlaceWidget(a){this.selectedSection;this.cfg;this.wrapper;this.map_canvas;this.map;this.placehoundPath;this.imagePath;this.init=function(){var d=this.initCfg(a);var b=jQuery("SCRIPT");b=b[b.length-1];if(d){var c=jQuery("<div></div>");WELOCALLY.ui.setStatus(c,d,"wl_error");jQuery(b).parent().before(c)}else{this.wrapper=this.makeWrapper();jQuery(b).parent().before(this.wrapper)}return this}}WELOCALLY_PlaceWidget.prototype.initCfg=function(a){var b=[];if(!a){b.push("Please provide a configuration")}if(!a.endpoint){a.endpoint="https://api.welocally.com"}if(!a.requestPath){a.requestPath="/geodb/place/1_0/"}if(!a.imagePath){a.imagePath="http://placehound.com/images/marker_all_base.png"}if(!a.placehoundPath){a.placehoundPath="http://placehound.com"}if(!a.zoom){a.zoom=16}if(!a.showShare){a.showShare=false}if(!a.id){a.id=WELOCALLY.util.keyGenerator()}if(b.length>0){return b}this.cfg=a};WELOCALLY_PlaceWidget.prototype.makeWrapper=function(){var a=this;var b=jQuery("<div></div>");jQuery(b).css("display","none");jQuery(b).attr("class","welocally_place_widget");jQuery(b).attr("id","welocally_place_widget_"+a.cfg.id);this.statusArea=jQuery('<div class="wl_place_status"></div>');jQuery(b).append(this.statusArea);this.map_canvas=document.createElement("DIV");jQuery(this.map_canvas).css("display","none");jQuery(this.map_canvas).attr("class","wl_places_place_map_canvas");jQuery(this.map_canvas).attr("id","wl_place_map_canvas_widget_"+a.cfg.id);jQuery(b).append(this.map_canvas);this.wrapper=b;return this.wrapper};WELOCALLY_PlaceWidget.prototype.load=function(b){var a=this;a.map=a.initMapForPlace(b,a.map_canvas);a.show(b);a.setMapEvents(a.map);var c=new google.maps.LatLng(b.geometry.coordinates[1],b.geometry.coordinates[0]);setTimeout(function(){a.refreshMap(c)},200)};WELOCALLY_PlaceWidget.prototype.initMapForPlace=function(d,g){var c=this;var h=new google.maps.LatLng(d.geometry.coordinates[1],d.geometry.coordinates[0]);var e={center:h,zoom:c.cfg.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP};if(c.cfg.styles){e.styles=c.cfg.styles}var f=new google.maps.Map(g,e);var a=new google.maps.MarkerImage(c.cfg.imagePath,new google.maps.Size(32,32),new google.maps.Point(32,0));var b=new google.maps.Marker({position:h,map:f,icon:a});jQuery(f).show();jQuery(g).show();return f};WELOCALLY_PlaceWidget.prototype.setMapEvents=function(c){var b=google.maps.event.addListener(c,"tilesloaded",function(){google.maps.event.removeListener(b);WELOCALLY.util.preload(["http://maps.google.com/mapfiles/openhand.cur"])});var a=google.maps.event.addListener(c,"idle",function(){WELOCALLY.util.preload(["http://maps.google.com/mapfiles/openhand.cur"])})},WELOCALLY_PlaceWidget.prototype.makePlaceContent=function(b,e){var j=this;var d=jQuery('<div class="wl_places_place_wrapper"></div>');if(!j.cfg.hidePlaceSectionMap){jQuery(d).append(this.map_canvas);j.map=j.initMapForPlace(b,this.map_canvas)}else{jQuery(this.map_canvas).hide()}if(b.properties.titlelink!=null&&b.properties.titlelink!=""){jQuery(d).append('<a href="'+b.properties.titlelink+'"><div class="wl_places_place_name">'+b.properties.name+"</a></div>")}else{jQuery(d).append('<div class="wl_places_place_name">'+b.properties.name+"</div>")}jQuery(d).append('<div class="wl_places_place_adress">'+b.properties.address+" "+b.properties.city+" "+b.properties.province+" "+b.properties.postcode+"</div>");if(b.properties.phone!=null){jQuery(d).append('<div class="wl_places_place_phone">'+b.properties.phone+"</div>")}var h=jQuery('<div id="wl_place_links" class="wl_place_links"></div>');if(b.properties.titlelink!=null&&b.properties.titlelink!=""){jQuery(h).append('<div class="wl_places_place_post_link"><a target="_new" href="'+b.properties.titlelink+'">See Post</a></div>')}if(b.properties.website!=null&&b.properties.website!=""){var c=b.properties.website;if(b.properties.website.indexOf("http://")==-1){c="http://"+b.properties.website}jQuery(h).append('<div class="wl_places_place_web_link"><a target="_new" href="'+c+'">Website</a></div>')}if(b.properties.city!=null&&b.properties.province!=null){var a=b.properties.city+" "+b.properties.province;if(b.properties.address!=null){qs=b.properties.address+" "+a}if(b.properties.postcode!=null){qs=qs+" "+b.properties.postcode}var g=qs.replace(" ","+");jQuery(h).append('<div class="wl_places_place_driving_link"><a href="http://maps.google.com/maps?f=d&source=s_q&hl=en&geocode=&q='+g+'" target="_new">Directions</a></div>')}var f=jQuery('<div id="wl_place_embed" class="wl_place_embed"></div>');if(!e.showShare){jQuery(f).hide()}jQuery(d).append(h);return d};WELOCALLY_PlaceWidget.prototype.show=function(a){this.wrapper.html(this.makePlaceContent(a,this.cfg));jQuery(this.wrapper).show()};WELOCALLY_PlaceWidget.prototype.refreshMap=function(c){var a=this;google.maps.event.trigger(a.map,"resize");var b=google.maps.event.addListener(a.map,"tilesloaded",function(){a.map.setCenter(c);google.maps.event.removeListener(b)})};WELOCALLY_PlaceWidget.prototype.getStatusArea=function(){var a=this;return a.statusArea};function WELOCALLY_PlacesMultiWidget(a){this.map;this.map_canvas;this.searchLocation;this.cfg;this.options;this.placeMarkers=[];this.mapStatus;this.results;this.selectedSection;this.infoBox;this.boxText;this.selectedMarkerIndex;this.init=function(){var d=this.initCfg(a);var b=jQuery("SCRIPT");b=b[b.length-1];if(d){var c=jQuery("<div></div>");WELOCALLY.ui.setStatus(c,d,"wl_error");jQuery(b).parent().before(c)}else{this.wrapper=this.makeWrapper();jQuery(b).parent().before(this.wrapper)}return this}}WELOCALLY_PlacesMultiWidget.prototype.initCfg=function(a){var b=[];if(!a){b.push("Please provide configuration for the widget");a={}}if(!a.hidePlaceSectionMaps){a.hidePlaceSectionMap=true}if(!a.id){a.id=WELOCALLY.util.keyGenerator()}if(!a.endpoint){a.endpoint="https://api.welocally.com"}if(!a.baseUrl){a.baseUrl="http://placehound.com"}if(!a.imagePath){a.imagePath=a.baseUrl+"/images/marker_all_base.png"}if(a.showSelection==null){a.showSelection=true}if(!a.zoom){a.zoom=16}if(b.length>0){return b}this.cfg=a};WELOCALLY_PlacesMultiWidget.prototype.makeWrapper=function(){var a=this;var b=jQuery("<div></div>");jQuery(b).attr("class","wl_places_multi_widget");jQuery(b).attr("id","wl_places_multi_widget_"+a.cfg.id);this.selectedSection=jQuery('<div class="wl_places_multi_selected"></div>');jQuery(this.selectedSection).css("display","none");jQuery(b).append(this.selectedSection);this.map_canvas=document.createElement("DIV");jQuery(this.map_canvas).css("display","none");jQuery(this.map_canvas).attr("class","wl_places_multi_map_canvas");jQuery(this.map_canvas).attr("id","welocally_places_multi_map_canvas_"+a.cfg.id);jQuery(b).append(this.map_canvas);this.mapStatus=jQuery('<div class="wl_places_multi_map_status"></div>');jQuery(b).append(this.mapStatus);this.results=jQuery('<ol id="wl_places_mutli_selectable"></ol>');jQuery(this.results).css("display","none");jQuery(this.results).bind("selectableselected",{instance:this},this.selectedItemHandler);jQuery(b).append(this.results);if(this.cfg.places!=null&&this.cfg.places.length>0){this.setPlaces(this.cfg.places)}else{this.map=this.initMap(this.map_canvas)}jQuery(this.results).selectable({cancel:"a"});this.wrapper=b;return b};WELOCALLY_PlacesMultiWidget.prototype.setPlaces=function(b){var a=this;if(a.map==null){a.map=a.initMapForPlaces(a.cfg.places,a.map_canvas,a.placeMarkers)}else{a.deleteOverlays(a.placeMarkers);a.addPlaces(a.map,b,a.placeMarkers);a.setMapEvents(a.map,a.placeMarkers)}if(!a.cfg.hideMap){jQuery(a.map_canvas).show()}};WELOCALLY_PlacesMultiWidget.prototype.initMap=function(d){var a=this;var b={mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:a.cfg.zoom};if(a.cfg.styles){b.styles=a.cfg.styles}var c=new google.maps.Map(d,b);a.boxText=document.createElement("div");a.boxText.className="wl_places_mutli_infobox";a.boxText.innerHTML="none selected";a.infoBox=this.makeInfoBox(a.boxText);return c};WELOCALLY_PlacesMultiWidget.prototype.initMapForPlaces=function(b,e,d){var a=this;var c=a.initMap(e);a.addPlaces(c,b,d);a.setMapEvents(c,d);return c};WELOCALLY_PlacesMultiWidget.prototype.makeInfoBox=function(c){var b=this;var d={content:c,disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(0,5),zIndex:null,boxStyle:{opacity:0.85},closeBoxMargin:"2px 2px 2px 2px",closeBoxURL:b.cfg.imagePath,infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};var a=new WELOCALLY_InfoBox(d);return a};WELOCALLY_PlacesMultiWidget.prototype.addPlaces=function(e,c,f){var a=this;var d=new google.maps.LatLngBounds();a.deleteOverlays(a.placeMarkers);jQuery(a.results).empty();jQuery(a.results).hide();a.infoBox.close();jQuery.each(c,function(h,l){var n=new google.maps.LatLng(l.geometry.coordinates[1],l.geometry.coordinates[0]);d.extend(n);var j=new google.maps.LatLng(l.geometry.coordinates[1],l.geometry.coordinates[0]);var g=null;if(a.cfg.showLetters){var m=(3*32)+(32*h);g=new google.maps.MarkerImage(a.cfg.imagePath,new google.maps.Size(32,32),new google.maps.Point(m,0))}else{g=new google.maps.MarkerImage(a.cfg.imagePath,new google.maps.Size(32,32),new google.maps.Point(32,0))}a.addMarker(h,f,e,j,l,g);if(a.cfg.showSelection){var k=a.makeItemContents(l,h,true);if(a.cfg.overrideSelectableStyle){jQuery(k).attr("style",a.cfg.overrideSelectableStyle)}jQuery(k).attr("id","wl_places_mutli_selectable_"+h);jQuery(k).attr("class","ui-widget-content");jQuery(k).mouseover(function(){jQuery(this).css("cursor","pointer")});jQuery(a.results).append(jQuery(k));jQuery(a.results).show()}});e.fitBounds(a.makeMinimumBounds(d));var b=new google.maps.MarkerImage(a.cfg.imagePath,new google.maps.Size(32,32),new google.maps.Point(0,0));a.addMarkerCenter(f,e,d.getCenter(),b);setTimeout(function(){a.refreshMap(d.getCenter(),d)},100);setTimeout(function(){a.refreshMap(d.getCenter(),d)},200)};WELOCALLY_PlacesMultiWidget.prototype.makeMinimumBounds=function(b){var a=this;var e=a.getBoundsDistance(b);if(e<0.03){var d=new google.maps.LatLng(b.getCenter().lat()-0.002,b.getCenter().lng()-0.002);var c=new google.maps.LatLng(b.getCenter().lat()+0.002,b.getCenter().lng()+0.002);b.extend(d);b.extend(c)}return b};WELOCALLY_PlacesMultiWidget.prototype.makeItemContents=function(d,b,f){var a=this;var g=jQuery("<li></il>");if(a.cfg.showLetters&&f){var e=(3*32)+(32*b);var c=jQuery('<span class="wl_selectable_marker" style="display:block; width: 32px; height: 32px; background:url('+a.cfg.imagePath+") -"+e+'px 0px; background-repeat:no-repeat;" />');jQuery(g).append(c)}if(a.cfg.idLinks){jQuery(g).append('<a href="'+a.cfg.baseUrl+"/place.html?id="+d.id+'"><div class="selectable_title">'+d.properties.name+"</a></div>")}else{if(d.properties.titlelink!=null&&d.properties.titlelink!=""){jQuery(g).append('<a href="'+d.properties.titlelink+'"><div class="selectable_title">'+d.properties.name+"</a></div>")}else{jQuery(g).append('<div class="selectable_title">'+d.properties.name+"</div>")}}jQuery(g).append(jQuery('<div class="selectable_address">'+d.properties.address+" "+d.properties.city+" "+d.properties.province+"</div>"));if(d.distance&&!a.cfg.hideDistance){jQuery(g).append(jQuery('<div class="selectable_distance">'+d.distance.toFixed(2)+"km </div>"))}g.item=d;return g};WELOCALLY_PlacesMultiWidget.prototype.setMapEvents=function(c,d){var a=this;google.maps.event.addListener(c,"zoom_changed",function(){zoomChangeBoundsListener=google.maps.event.addListener(c,"bounds_changed",function(e){a.setStatus(a.mapStatus,a.makeMapStatus(a.map,a.placeMarkers),"wl_message",false)})});var b=google.maps.event.addListener(c,"tilesloaded",function(){a.setStatus(a.mapStatus,a.makeMapStatus(a.map,a.placeMarkers),"wl_message",false);google.maps.event.removeListener(b);WELOCALLY.util.preload(["http://maps.google.com/mapfiles/openhand.cur"])})},WELOCALLY_PlacesMultiWidget.prototype.selectedItemHandler=function(e,f){var b=null;var a;var c;if(this.nodeName=="OL"){b=e.data.instance;c=f.selected.id.replace("wl_places_mutli_selectable_","");a=b.placeMarkers[c];b.selectedPlace=b.placeMarkers[c].item}else{if(this.nodeName=="MARKER"){b=this.instance;a=this;c=a.index;jQuery("#wl_places_mutli_selectable_"+b.selectedMarkerIndex).removeClass("ui-selected");jQuery("#wl_places_mutli_selectable_"+c).addClass("ui-selected");b.selectedPlace=this.item}}b.selectedMarkerIndex=c;a.map.panTo(a.position);var d=b.makeItemContents(b.selectedPlace,0,false);jQuery(d).attr("class","wl_places_multi_infobox");jQuery(d).css("min-width","100px");jQuery(d).css("min-height","30px");jQuery(b.boxText).html(d);jQuery(b.boxText).find("li a img").load(function(){jQuery(b.boxText).find("li a").css("background","none").css("padding","0px");jQuery(b.boxText).css("line-height","5px");jQuery(b.boxText).find("ul").css("margin","0px")});b.infoBox.setOffset(d);b.infoBox.open(a.map,a);if(b!=null){if(b.cfg.observers!=null&&b.cfg.observers.length>0){jQuery.each(b.cfg.observers,function(g,h){h.show(b.selectedPlace)});jQuery(b.getSelectedArea()).show()}}};WELOCALLY_PlacesMultiWidget.prototype.resetOverlays=function(c,a){var b=this;b.map.setCenter(c);jQuery(b.map_canvas).show();jQuery(b.map).show();b.deleteOverlays(a);b.placeMarkers=[]};WELOCALLY_PlacesMultiWidget.prototype.refreshMap=function(e,c){var a=this;google.maps.event.trigger(a.map,"resize");if(a.placeMarkers.length==0){var b=new google.maps.MarkerImage(a.cfg.imagePath,new google.maps.Size(32,32),new google.maps.Point(0,0));a.addMarkerCenter(a.placeMarkers,a.map,e,b)}a.setStatus(a.mapStatus,a.makeMapStatus(a.map,a.placeMarkers),"wl_message",false);a.map.setCenter(e);if(c!=null){a.map.fitBounds(c)}var d=google.maps.event.addListener(a.map,"tilesloaded",function(){google.maps.event.removeListener(d);a.map.setCenter(e);a.setStatus(a.mapStatus,a.makeMapStatus(a.map,a.placeMarkers),"wl_message",false)})};WELOCALLY_PlacesMultiWidget.prototype.showOverlays=function(a,b){if(a){for(i in a){a[i].setMap(b)}}};WELOCALLY_PlacesMultiWidget.prototype.deleteOverlays=function(a){if(a){for(i in a){a[i].setMap(null)}a.length=0}};WELOCALLY_PlacesMultiWidget.prototype.colName=function(c){var a=this;var b="";while(c>=0){b=String.fromCharCode(c%26+65)+b;c=Math.floor(c/26)-1}return b};WELOCALLY_PlacesMultiWidget.prototype.addMarker=function(f,b,a,e,h,g){var d=this;var c=new google.maps.Marker({index:f,nodeName:"MARKER",instance:this,position:e,title:h.properties.name,map:a,icon:g,item:h});google.maps.event.addListener(c,"click",this.selectedItemHandler);b.push(c)};WELOCALLY_PlacesMultiWidget.prototype.addMarkerCenter=function(b,a,e,f){var d=this;var c=new google.maps.Marker({instance:this,position:e,map:a,icon:f});b.push(c)};WELOCALLY_PlacesMultiWidget.prototype.clearOverlays=function(a){if(a){for(i in a){a[i].setMap(null)}}};WELOCALLY_PlacesMultiWidget.prototype.getMapRadius=function(c){var a=this;if(a.map.getBounds()){var b=a.map.getBounds();return a.getBoundsDistance(b)/2}else{return 0}};WELOCALLY_PlacesMultiWidget.prototype.getBoundsDistance=function(a){var k=this;if(a){var c=a.getCenter();var e=a.getNorthEast();var b=6378.8;var g=c.lat()/57.2958;var j=c.lng()/57.2958;var f=e.lat()/57.2958;var h=e.lng()/57.2958;var d=b*Math.acos(Math.sin(g)*Math.sin(f)+Math.cos(g)*Math.cos(f)*Math.cos(h-j));return d}return 0};WELOCALLY_PlacesMultiWidget.prototype.setStatus=function(d,e,c,b){var a=this;jQuery(d).html("");jQuery(d).removeClass();jQuery(d).addClass(c);if(b){}jQuery(d).append("<em>"+e+"</em>");if(e!=""){jQuery(d).show()}else{jQuery(d).hide()}};WELOCALLY_PlacesMultiWidget.prototype.makeMapStatus=function(map,markers){var _instance=this;var status="";var radius=_instance.getMapRadius(_instance.map);if(markers!=null&&markers.length>1){status=status+" places found: "+eval(markers.length-1)}status=status+" search radius: "+radius.toFixed(2)+"km";status=status+" zoom: "+map.getZoom();return status};WELOCALLY_PlacesMultiWidget.prototype.getSelectedArea=function(){var a=this;return a.selectedSection};WELOCALLY_PlacesMultiWidget.prototype.getStatusArea=function(){var a=this;return a.mapStatus};WELOCALLY_PlacesMultiWidget.prototype.triggerResize=function(){var a=this;google.maps.event.trigger(a.map,"resize")};WELOCALLY_PlacesMultiWidget.prototype.show=function(a){jQuery(this.results).trigger("observerselected",{instance:this,type:observer,place:a},this.selectedItemHandler)};