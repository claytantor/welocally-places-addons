function WELOCALLY_PlaceWidget(a){this.selectedSection;this.cfg;this.wrapper;this.map_canvas;this.map;this.placehoundPath;this.imagePath;this.init=function(){var d=this.initCfg(a);var b=jQuery("SCRIPT");b=b[b.length-1];if(d){var c=jQuery("<div></div>");WELOCALLY.ui.setStatus(c,d,"wl_error");jQuery(b).parent().before(c)}else{this.wrapper=this.makeWrapper();jQuery(b).parent().before(this.wrapper)}return this}}WELOCALLY_PlaceWidget.prototype.initCfg=function(a){var b=[];if(!a){b.push("Please provide a configuration")}if(!a.endpoint){a.endpoint="https://api.welocally.com"}if(!a.requestPath){a.requestPath="/geodb/place/1_0/"}if(!a.imagePath){a.imagePath="http://placehound.com/images/marker_all_base.png"}if(!a.placehoundPath){a.placehoundPath="http://placehound.com"}if(!a.zoom){a.zoom=16}if(!a.showShare){a.showShare=false}if(!a.id){a.id=WELOCALLY.util.keyGenerator()}if(b.length>0){return b}this.cfg=a};WELOCALLY_PlaceWidget.prototype.makeWrapper=function(){var a=this;var b=jQuery("<div></div>");jQuery(b).css("display","none");jQuery(b).attr("class","welocally_place_widget");jQuery(b).attr("id","welocally_place_widget_"+a.cfg.id);this.statusArea=jQuery('<div class="wl_place_status"></div>');jQuery(b).append(this.statusArea);this.map_canvas=document.createElement("DIV");jQuery(this.map_canvas).css("display","none");jQuery(this.map_canvas).attr("class","wl_places_place_map_canvas");jQuery(this.map_canvas).attr("id","wl_place_map_canvas_widget_"+a.cfg.id);jQuery(b).append(this.map_canvas);this.wrapper=b;return this.wrapper};WELOCALLY_PlaceWidget.prototype.load=function(b){var a=this;a.map=a.initMapForPlace(b,a.map_canvas);a.show(b);a.setMapEvents(a.map);var c=new google.maps.LatLng(b.geometry.coordinates[1],b.geometry.coordinates[0]);setTimeout(function(){a.refreshMap(c)},200)};WELOCALLY_PlaceWidget.prototype.initMapForPlace=function(d,g){var c=this;var h=new google.maps.LatLng(d.geometry.coordinates[1],d.geometry.coordinates[0]);var e={center:h,zoom:c.cfg.zoom,mapTypeId:google.maps.MapTypeId.ROADMAP};if(c.cfg.styles){e.styles=c.cfg.styles}var f=new google.maps.Map(g,e);var a=new google.maps.MarkerImage(c.cfg.imagePath,new google.maps.Size(32,32),new google.maps.Point(32,0));var b=new google.maps.Marker({position:h,map:f,icon:a});jQuery(f).show();jQuery(g).show();return f};WELOCALLY_PlaceWidget.prototype.setMapEvents=function(c){var b=google.maps.event.addListener(c,"tilesloaded",function(){google.maps.event.removeListener(b);WELOCALLY.util.preload(["http://maps.google.com/mapfiles/openhand.cur"])});var a=google.maps.event.addListener(c,"idle",function(){WELOCALLY.util.preload(["http://maps.google.com/mapfiles/openhand.cur"])})},WELOCALLY_PlaceWidget.prototype.makePlaceContent=function(b,e){var i=this;var d=jQuery('<div class="wl_places_place_wrapper"></div>');if(!i.cfg.hidePlaceSectionMap){jQuery(d).append(this.map_canvas);i.map=i.initMapForPlace(b,this.map_canvas)}else{jQuery(this.map_canvas).hide()}if(b.properties.titlelink!=null&&b.properties.titlelink!=""){jQuery(d).append('<a href="'+b.properties.titlelink+'"><div class="wl_places_place_name">'+b.properties.name+"</a></div>")}else{jQuery(d).append('<div class="wl_places_place_name">'+b.properties.name+"</div>")}jQuery(d).append('<div class="wl_places_place_adress">'+b.properties.address+" "+b.properties.city+" "+b.properties.province+" "+b.properties.postcode+"</div>");if(b.properties.phone!=null){jQuery(d).append('<div class="wl_places_place_phone">'+b.properties.phone+"</div>")}var h=jQuery('<div id="wl_place_links" class="wl_place_links"></div>');if(b.properties.titlelink!=null&&b.properties.titlelink!=""){jQuery(h).append('<div class="wl_places_place_post_link"><a target="_new" href="'+b.properties.titlelink+'">See Post</a></div>')}if(b.properties.website!=null&&b.properties.website!=""){var c=b.properties.website;if(b.properties.website.indexOf("http://")==-1){c="http://"+b.properties.website}jQuery(h).append('<div class="wl_places_place_web_link"><a target="_new" href="'+c+'">Website</a></div>')}if(b.properties.city!=null&&b.properties.province!=null){var a=b.properties.city+" "+b.properties.province;if(b.properties.address!=null){qs=b.properties.address+" "+a}if(b.properties.postcode!=null){qs=qs+" "+b.properties.postcode}var g=qs.replace(" ","+");jQuery(h).append('<div class="wl_places_place_driving_link"><a href="http://maps.google.com/maps?f=d&source=s_q&hl=en&geocode=&q='+g+'" target="_new">Directions</a></div>')}var f=jQuery('<div id="wl_place_embed" class="wl_place_embed"></div>');if(!e.showShare){jQuery(f).hide()}jQuery(d).append(h);return d};WELOCALLY_PlaceWidget.prototype.show=function(a){this.wrapper.html(this.makePlaceContent(a,this.cfg));jQuery(this.wrapper).show()};WELOCALLY_PlaceWidget.prototype.refreshMap=function(c){var a=this;google.maps.event.trigger(a.map,"resize");var b=google.maps.event.addListener(a.map,"tilesloaded",function(){a.map.setCenter(c);google.maps.event.removeListener(b)})};WELOCALLY_PlaceWidget.prototype.getStatusArea=function(){var a=this;return a.statusArea};